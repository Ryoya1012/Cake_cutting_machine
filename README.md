# Cake_cutting_machine

## The purpose
 The robot recognizes the cake and performs actions such as cutting and rotating the cake.

## Specification
 - Vision-related
    - Cake_cutting_opencv : Python opencv

 - ESP32-related
    - Moving_motorv : Arduino IDE(using MPU : ESP32)


## Program
  esp32_communication.py  
   このコードは, ウェブカメラでケーキの回転システムを制御するプログラムになっています.  
   ケーキを指定した分割数に基づき等分線を計算し, 各等分線にナイフの刃先が来るようにESP32とシリアル通信を用いてその回転を制御する.  

### 処理の流れ
    0. 前処理
      * PCにウェブカメラ, ESP32が接続されているかの確認.  
      　もし, 接続されていない場合は, "ウェブカメラが見つかりません"若しくは, "ESP32接続エラー"とターミナルに表示されます.
        再度, ウェブカメラ, ESP32が接続されているか, ポート番号が合っているか確認してください.  

    1. カメラ映像のキャプチャ  
      * OpenCVを使用してカメラ映像をキャプチャし, 画像を処理する  
      * cv2.HoughCirclesを使用して円を検出する. 検出した円の中心と半径を用いて回転を計算する.  
   
    2. 回転角度の計算
      * 円の中心と参照点(円周上の1点)を使用して, 回転角度を計算する.  
      * 現在の回転角度と前回の角度を基に, 累積回転角度を計算する.  
   
    3. ESP32との通信  
      * ケーキを回転(サーボモータを使用し)させるために, 目標角度をESP32に送信.  
      * ESP32は回転が完了すると"READY"のメッセージを返し, 次の処理をESP32に指令する.  
   
    4. 分割線の描画  
      * 円と分割線を描画して, 現在の回転状態を可視化する.  
   
    5. 回転完了後  
      * すべての目標角度に到達した後, 回転処理が完了する.  

  ### プログラムの処理の流れ
    1. ESP32への接続思考
    - 目的:ESP32(外部デバイス)との通信を確立します.
    - 処理:  
     1. ```initialize_esp32```関数が呼び出され, 指定ポート(COM3)で接続を試みます.
     2. 成功した場合:
        - ESP32が接続され,「ESP32に接続しました」と表示される.
     3. 失敗した場合:
        - エラーが表示され, プログラムが終了する(```exit()```).
    
    2. ユーザーからの入力
    - 目的:ユーザーがケーキを何等分するかを指定する.
    - 処理:  
        - プロンプト```ケーキを何等分にしますか?:```を表示.
        - ユーザーが入力した数値を整数(```int型```)として受け取り, 分割数(```num_divisions```)に保存.

    3. カメラの起動
      1. OPenCVの```cv2.VideoCapture(1)```を使用してカメラを起動.
       - 引数```1```はカメラデバイス番号を指定する.
      2. カメラが見つからなかった場合:
        - エラーメッセージ「ウェブカメラが見つかりません」を表示し, プログラムを終了します
    
    3. 